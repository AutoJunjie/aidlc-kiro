# ADR-003: 采用前后端分离架构

## 状态
Accepted

## 日期
2025-11-10

## 背景

XHolacracy MVP 需要提供用户界面来管理组织结构、角色、提案和会议。我们需要决定前端和后端的架构模式：
1. 是否前后端分离？
2. 如何组织前端代码？
3. 如何实现前后端通信？

系统需求：
- 支持复杂的交互（圈子层级图、角色关系图、集成决策流程）
- 提供良好的用户体验
- 支持未来扩展（可能的移动端）
- 便于团队协作开发

## 决策

我们决定采用 **前后端分离架构**：

**前端**:
- 使用 React 18+ 和 TypeScript
- 独立的前端项目，单独部署
- 通过 REST API 与后端通信
- 使用 React Query 管理服务器状态
- 使用 D3.js/ReactFlow 实现可视化

**后端**:
- 使用 Java Spring Boot
- 提供 RESTful API
- 独立的后端服务，单独部署
- 返回 JSON 格式数据

**通信方式**:
- HTTP/HTTPS + JSON
- RESTful API 设计
- JWT 认证

## 替代方案

### 方案 1: 服务端渲染（SSR）
使用 Spring Boot + Thymeleaf 或 JSP 进行服务端渲染。

**优点**:
- 简单直接，单一技术栈
- SEO 友好
- 首屏加载快
- 部署简单（单一应用）

**缺点**:
- 用户体验较差（页面刷新）
- 难以实现复杂的交互（如拖拽、实时更新）
- 前后端耦合，难以独立开发
- 不适合构建现代化的单页应用
- 难以扩展到移动端

**为什么没有选择**: 系统需要复杂的交互和可视化（圈子层级图、角色关系图、集成决策流程），服务端渲染难以提供良好的用户体验。

### 方案 2: 单体应用（前端嵌入后端）
将 React 构建产物嵌入 Spring Boot 应用，作为静态资源提供。

**优点**:
- 部署简单（单一应用）
- 无跨域问题
- 开发环境配置简单

**缺点**:
- 前后端耦合，难以独立开发和部署
- 构建流程复杂
- 难以实现前后端独立扩展
- 团队协作不便（前后端开发者需要共享代码库）

**为什么没有选择**: 虽然部署简单，但限制了前后端的独立性，不利于团队协作和未来扩展。

### 方案 3: GraphQL API
使用 GraphQL 代替 REST API。

**优点**:
- 灵活的数据查询
- 减少网络请求
- 强类型系统
- 避免过度获取或获取不足

**缺点**:
- 学习曲线陡峭
- 后端实现复杂
- 缓存策略复杂
- 对于 MVP 来说过度设计

**为什么没有选择**: 对于 MVP 阶段，REST API 足够满足需求，GraphQL 增加了不必要的复杂度。未来如果需要可以考虑迁移。

### 方案 4: 微前端架构
将前端拆分为多个独立的微应用。

**优点**:
- 团队独立开发和部署
- 技术栈灵活
- 易于扩展

**缺点**:
- 架构复杂
- 性能开销
- 状态共享困难
- 对于 MVP 来说过度设计

**为什么没有选择**: 系统规模不大，不需要微前端的复杂性。单一的 React 应用足够满足需求。

## 后果

### 正面影响
- **独立开发和部署**：前后端团队可以独立工作，互不阻塞
- **更好的用户体验**：React 提供流畅的单页应用体验，无页面刷新
- **技术栈灵活**：前后端可以选择最适合的技术
- **易于扩展**：未来可以轻松添加移动端或其他客户端
- **代码复用**：前端组件可以复用，后端 API 可以被多个客户端使用
- **并行开发**：前后端可以并行开发，通过 API 契约协作
- **性能优化**：可以独立优化前端和后端性能
- **现代化交互**：支持复杂的可视化和交互（圈子层级图、角色关系图）

### 负面影响
- **部署复杂度增加**：需要部署两个独立的应用
- **跨域问题**：需要配置 CORS
- **API 设计成本**：需要设计和维护 REST API
- **网络延迟**：前后端分离增加了网络请求
- **开发环境配置**：需要同时运行前端和后端开发服务器

### 风险
- **API 契约不一致**：前后端 API 契约可能不同步
- **认证复杂度**：需要实现 JWT 等认证机制
- **调试困难**：前后端分离增加了调试复杂度

### 缓解措施
- 使用 OpenAPI/Swagger 定义 API 契约，确保前后端一致
- 使用 Docker Compose 简化开发环境配置
- 实施 API 版本管理策略
- 使用 Axios 拦截器统一处理认证和错误
- 编写详细的 API 文档
- 使用集成测试验证前后端集成
- 配置 CORS 允许开发环境跨域请求

## 相关决策
- [ADR-005](./005-use-react-query-for-state-management.md): 使用 React Query 进行状态管理

## 参考资料
- [React Official Documentation](https://react.dev/)
- [Spring Boot REST API Best Practices](https://spring.io/guides/tutorials/rest/)
- [RESTful API Design Guidelines](https://restfulapi.net/)
